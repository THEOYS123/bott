{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>OSINT Analysis Result</h1>
    <a href="{{ url_for('web.osint_form') }}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Analisis Baru</a>
</div>

{% if result.status == 'success' %}
    {% set data = result.data %}
    {% set sec = data.security_assessment %}
    {% set risk_level = sec.overall_risk_level %}
    {% set risk_class = {'Rendah': 'success', 'Sedang': 'warning', 'Tinggi': 'danger'}.get(risk_level, 'secondary') %}
    
    <div class="card mb-4 border-{{ risk_class }}">
        <div class="card-header bg-{{ risk_class }} text-white">
            <i class="bi bi-shield-check me-2"></i>Ringkasan Analisis
        </div>
        <div class="card-body d-flex justify-content-around text-center">
            <div>
                <h6 class="text-muted">Nomor Target</h6>
                <h5>{{ data.phone_identity.e164_format }}</h5>
            </div>
            <div>
                <h6 class="text-muted">Tingkat Risiko</h6>
                <h5 class="text-{{ risk_class }}">{{ risk_level }}</h5>
            </div>
            <div>
                <h6 class="text-muted">Kebocoran Data</h6>
                <h5>{{ sec.data_breaches.breaches|length }} ditemukan</h5>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-6 mb-4">
            <div class="card h-100">
                <div class="card-header"><i class="bi bi-telephone-fill me-2"></i>Identitas Telepon & Operator</div>
                <ul class="list-group list-group-flush">
                    {% for key, value in data.phone_identity.items() %}
                    <li class="list-group-item d-flex justify-content-between"><strong>{{ key.replace('_', ' ').title() }}</strong><span>{{ value }}</span></li>
                    {% endfor %}
                    {% if data.carrier_info.status == 'success' %}
                    <li class="list-group-item d-flex justify-content-between"><strong>Line Type</strong><span>{{ data.carrier_info.line_type }}</span></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="col-xl-6 mb-4">
            <div class="card h-100">
                <div class="card-header"><i class="bi bi-person-lines-fill me-2"></i>Jejak Digital</div>
                {% set df = data.digital_footprint %}
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between"><strong>Akun Google</strong><span>{% if df.google_account.status == 'found' %}<i class="bi bi-check-circle-fill text-success"></i> Ditemukan ({{ df.google_account.full_name }}){% else %}<i class="bi bi-x-circle-fill text-danger"></i> Tidak Ditemukan{% endif %}</span></li>
                    <li class="list-group-item d-flex justify-content-between"><strong>WhatsApp</strong><span>{% if df.messaging_apps.apps.WhatsApp.registered %}<i class="bi bi-check-circle-fill text-success"></i> Terdaftar{% else %}<i class="bi bi-x-circle-fill text-danger"></i> Tidak Terdaftar{% endif %}</span></li>
                    <li class="list-group-item d-flex justify-content-between"><strong>Signal</strong><span>{% if df.messaging_apps.apps.Signal.registered %}<i class="bi bi-check-circle-fill text-success"></i> Terdaftar{% else %}<i class="bi bi-x-circle-fill text-danger"></i> Tidak Terdaftar{% endif %}</span></li>
                </ul>
            </div>
        </div>

        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header"><i class="bi bi-shield-exclamation me-2"></i>Penilaian Keamanan</div>
                <div class="card-body">
                    <h5 class="card-title">Laporan Spam</h5>
                    <p>Tingkat Risiko: <strong>{{ sec.spam_report.level }}</strong> | Skor: <strong>{{ sec.spam_report.score }}</strong> | Laporan: <strong>{{ sec.spam_report.reports }}</strong></p>
                    <hr>
                    <h5 class="card-title mt-4">Potensi Kebocoran Data</h5>
                    {% if sec.data_breaches.breaches %}
                        <ul class="list-group">
                        {% for breach in sec.data_breaches.breaches %}
                            <li class="list-group-item">
                                <strong>{{ breach.source }}</strong> ({{ breach.date }})<br>
                                <small class="text-muted">Data Terekspos: {{ breach.compromised_data|join(', ') }}</small>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-success">Tidak ditemukan indikasi kebocoran data pada sumber yang diperiksa.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% else %}
    <div class="alert alert-danger">
        <h4><i class="bi bi-exclamation-triangle-fill"></i> Analisis Gagal</h4>
        <p>{{ result.message }}</p>
    </div>
{% endif %}
{% endblock %}
